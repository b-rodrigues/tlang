; src/dune

(include_subdirs unqualified)

; Generate C compiler flags from pkg-config for arrow-glib
(rule
 (targets arrow_cflags.sexp)
 (action (with-stdout-to %{targets}
  (bash "if pkg-config --cflags arrow-glib >/dev/null 2>&1; then echo -n '('; pkg-config --cflags arrow-glib | tr ' ' '\\n' | sed '/^$/d' | sed 's/.*/\"&\"/' | tr '\\n' ' '; echo ')'; else echo '()'; fi"))))

(rule
 (targets arrow_libs.sexp)
 (action (with-stdout-to %{targets}
  (bash "if pkg-config --libs arrow-glib >/dev/null 2>&1; then echo -n '('; pkg-config --libs arrow-glib | tr ' ' '\\n' | sed '/^$/d' | sed 's/.*/\"&\"/' | tr '\\n' ' '; echo ')'; else echo '()'; fi"))))

(library
 (name t_lang)
 (wrapped false)
 (foreign_stubs
  (language c)
  (names arrow_stubs)
  (flags (:include arrow_cflags.sexp)))
 (c_library_flags (:include arrow_libs.sexp))
 (modules
   ; arrow â€” Arrow-backed table implementation
   arrow_table arrow_ffi arrow_bridge arrow_io arrow_compute arrow_column
   ; core language
   ast lexer parser eval
   ; packages/core
   t_print t_type length head tail is_error t_seq t_map sum pretty_print packages
   ; packages/base
   t_assert is_na na error_mod error_utils
   ; packages/dataframe
   t_read_csv colnames nrow ncol
   ; packages/pipeline
   pipeline_nodes pipeline_deps pipeline_node pipeline_run
   ; packages/colcraft
   t_select t_filter mutate arrange group_by summarize
   ; packages/math
   t_sqrt t_abs t_log t_exp pow
   ; packages/stats
   mean sd quantile cor lm
   ; packages/explain
   intent_fields intent_get t_explain explain_json
 )
 (libraries menhirLib)
)

(executable
 (name repl)
 (modules repl)
 (libraries t_lang menhirLib)
)

(menhir
 (modules parser)
)

(ocamllex lexer)
